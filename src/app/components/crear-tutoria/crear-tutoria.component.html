<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
  <div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-2xl shadow-xl" style="min-height: 600px;">

      <!-- Header del Formulario -->
      <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-8">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
            <mat-icon class="text-3xl">add_circle</mat-icon>
          </div>
          <div class="text-center md:text-left">
            <h1 class="text-3xl font-bold mb-2">Crear Nueva Tutoría</h1>
            <p class="text-blue-100 text-lg">
              Comparte tu conocimiento creando una sesión de estudio para otros estudiantes.
            </p>
          </div>
        </div>
      </header>

      <!-- Formulario Principal -->
      <form [formGroup]="tutoriaForm" (ngSubmit)="onSubmit()" class="p-8 pb-12 space-y-8">

        <!-- Sección: Información Básica -->
        <section class="space-y-6">
          <div class="flex items-center gap-3 pb-2 border-b border-gray-200">
            <mat-icon class="text-blue-600 text-2xl">info</mat-icon>
            <h2 class="text-2xl font-semibold text-gray-800">Información Básica</h2>
          </div>

           <!-- Campo: Título -->
           <div class="space-y-2">
             <label for="titulo" class="block text-sm font-medium text-gray-700">Título de la Tutoría *</label>
             <div class="relative">
               <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">title</mat-icon>
               <input
                 id="titulo"
                 matInput
                 formControlName="titulo"
                 placeholder="Ej: Resolviendo ejercicios de Cálculo II"
                 maxlength="100"
                 class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
            </div>
            <div class="text-red-500 text-sm" *ngIf="tutoriaForm.get('titulo')?.invalid && tutoriaForm.get('titulo')?.touched">
              {{ getErrorMessage('titulo') }}
            </div>
          </div>

           <!-- Campo: Descripción -->
           <div class="space-y-2">
             <label for="descripcion" class="block text-sm font-medium text-gray-700">Descripción *</label>
             <div class="relative">
               <mat-icon class="absolute left-3 top-4 text-gray-400 pointer-events-none">description</mat-icon>
               <textarea
                 id="descripcion"
                 matInput
                 formControlName="descripcion"
                 placeholder="Describe el contenido, objetivos y lo que aprenderán los participantes"
                 rows="5"
                 maxlength="500"
                 class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-vertical"></textarea>
            </div>
            <div class="text-red-500 text-sm" *ngIf="tutoriaForm.get('descripcion')?.invalid && tutoriaForm.get('descripcion')?.touched">
              {{ getErrorMessage('descripcion') }}
            </div>
          </div>
        </section>

        <!-- Sección: Detalles de la Tutoría -->
        <section class="space-y-6">
          <div class="flex items-center gap-3 pb-2 border-b border-gray-200">
            <mat-icon class="text-blue-600 text-2xl">tune</mat-icon>
            <h2 class="text-2xl font-semibold text-gray-800">Detalles de la Tutoría</h2>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <!-- Campo: Materia -->
             <div>
               <label for="materia" class="block text-sm font-semibold text-gray-900 mb-2">
                 Materia <span class="text-red-500">*</span>
               </label>
               <div class="relative">
                 <mat-icon class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-0">book</mat-icon>
                 <select
                   id="materia"
                   formControlName="materia"
                   class="relative z-10 w-full pl-12 pr-10 py-3.5 text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white cursor-pointer appearance-none"
                   style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em 1.25em;"
                   [class.border-red-300]="tutoriaForm.get('materia')?.invalid && tutoriaForm.get('materia')?.touched">
                  <option value="">Selecciona una materia</option>
                  <option *ngFor="let materia of materiasDisponibles" [value]="materia">
                    {{ materia }}
                  </option>
                </select>
              </div>
              <span class="text-sm text-red-600 font-medium block mt-2" *ngIf="tutoriaForm.get('materia')?.invalid && tutoriaForm.get('materia')?.touched">
                {{ getErrorMessage('materia') }}
              </span>
            </div>

             <!-- Campo: Nivel Requerido -->
             <div>
               <label for="nivelRequerido" class="block text-sm font-semibold text-gray-900 mb-2">
                 Nivel Requerido <span class="text-red-500">*</span>
               </label>
               <div class="relative">
                 <mat-icon class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-0">signal_cellular_alt</mat-icon>
                 <select
                   id="nivelRequerido"
                   formControlName="nivelRequerido"
                   class="relative z-10 w-full pl-12 pr-10 py-3.5 text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white cursor-pointer appearance-none"
                   style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em 1.25em;"
                   [class.border-red-300]="tutoriaForm.get('nivelRequerido')?.invalid && tutoriaForm.get('nivelRequerido')?.touched">
                  <option value="">Selecciona un nivel</option>
                  <option *ngFor="let nivel of niveles" [value]="nivel">
                    {{ nivel }}
                  </option>
                </select>
              </div>
              <span class="text-sm text-red-600 font-medium block mt-2" *ngIf="tutoriaForm.get('nivelRequerido')?.invalid && tutoriaForm.get('nivelRequerido')?.touched">
                {{ getErrorMessage('nivelRequerido') }}
              </span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <!-- Campo: Modalidad -->
             <div>
               <label for="modalidad" class="block text-sm font-semibold text-gray-900 mb-2">
                 Modalidad <span class="text-red-500">*</span>
               </label>
               <div class="relative">
                 <mat-icon class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-0">meeting_room</mat-icon>
                 <select
                   id="modalidad"
                   formControlName="modalidad"
                   class="relative z-10 w-full pl-12 pr-10 py-3.5 text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white cursor-pointer appearance-none"
                   style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em 1.25em;"
                   [class.border-red-300]="tutoriaForm.get('modalidad')?.invalid && tutoriaForm.get('modalidad')?.touched">
                  <option value="">Selecciona una modalidad</option>
                  <option *ngFor="let modalidad of modalidades" [value]="modalidad">
                    {{ modalidad }}
                  </option>
                </select>
              </div>
              <span class="text-sm text-red-600 font-medium block mt-2" *ngIf="tutoriaForm.get('modalidad')?.invalid && tutoriaForm.get('modalidad')?.touched">
                {{ getErrorMessage('modalidad') }}
              </span>
            </div>

             <!-- Campo: Cupo Máximo -->
             <div class="space-y-2">
               <label for="cupoMaximo" class="block text-sm font-medium text-gray-700">Cupo Máximo (1-20) *</label>
               <div class="relative">
                 <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">people</mat-icon>
                 <input
                   id="cupoMaximo"
                   matInput
                   type="number"
                   formControlName="cupoMaximo"
                   placeholder="1"
                   min="1"
                   max="20"
                   class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              </div>
              <div class="text-red-500 text-sm" *ngIf="tutoriaForm.get('cupoMaximo')?.invalid && tutoriaForm.get('cupoMaximo')?.touched">
                {{ getErrorMessage('cupoMaximo') }}
              </div>
            </div>
          </div>

           <!-- Campo: Fecha y Hora -->
           <div class="space-y-2">
             <label for="fechaHora" class="block text-sm font-semibold text-gray-900 mb-2">
               Fecha y Hora <span class="text-red-500">*</span>
             </label>
             <div class="relative">
               <mat-icon class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-0">schedule</mat-icon>
               <input
                 id="fechaHora"
                 type="datetime-local"
                 formControlName="fechaHora"
                 class="relative z-10 w-full pl-12 pr-4 py-3.5 text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white cursor-pointer"
                 [class.border-red-300]="tutoriaForm.get('fechaHora')?.invalid && tutoriaForm.get('fechaHora')?.touched">
            </div>
            <span class="text-sm text-red-600 font-medium block mt-2" *ngIf="tutoriaForm.get('fechaHora')?.invalid && tutoriaForm.get('fechaHora')?.touched">
              {{ getErrorMessage('fechaHora') }}
            </span>
          </div>

           <!-- Campo: Ubicación -->
           <div class="space-y-2" *ngIf="tutoriaForm.get('modalidad')?.value === 'Presencial' || tutoriaForm.get('modalidad')?.value === 'Hibrida'">
             <label for="ubicacionPresencial" class="block text-sm font-medium text-gray-700">Ubicación Presencial * (si aplica)</label>
             <div class="relative">
               <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">location_on</mat-icon>
               <input
                 id="ubicacionPresencial"
                 matInput
                 formControlName="ubicacionPresencial"
                 placeholder="Ej: Biblioteca Central, Sala 101"
                 class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="text-red-500 text-sm" *ngIf="tutoriaForm.get('ubicacionPresencial')?.invalid && tutoriaForm.get('ubicacionPresencial')?.touched">
              {{ getErrorMessage('ubicacionPresencial') }}
            </div>
          </div>

           <!-- Campo: Enlace Virtual -->
           <div class="space-y-2" *ngIf="tutoriaForm.get('modalidad')?.value === 'Virtual' || tutoriaForm.get('modalidad')?.value === 'Hibrida'">
             <label for="enlaceVirtual" class="block text-sm font-medium text-gray-700">Enlace Virtual * (si aplica)</label>
             <div class="relative">
               <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">link</mat-icon>
               <input
                 id="enlaceVirtual"
                 matInput
                 formControlName="enlaceVirtual"
                 placeholder="https://ejemplo.zoom.us/..."
                 type="url"
                 class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="text-red-500 text-sm" *ngIf="tutoriaForm.get('enlaceVirtual')?.invalid && tutoriaForm.get('enlaceVirtual')?.touched">
              {{ getErrorMessage('enlaceVirtual') }}
            </div>
          </div>
        </section>

        <!-- Sección: Temas Específicos -->
        <section class="space-y-6">
          <div class="flex items-center gap-3 pb-2 border-b border-gray-200">
            <mat-icon class="text-blue-600 text-2xl">fact_check</mat-icon>
            <h2 class="text-2xl font-semibold text-gray-800">Temas Específicos (Opcional)</h2>
          </div>

          <p class="text-gray-600">
            Agrega hasta 10 temas puntuales que se tratarán en la tutoría.
          </p>

          <div class="space-y-2">
            <div class="relative">
              <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">add</mat-icon>
              <input
                type="text"
                [(ngModel)]="nuevoTema"
                [ngModelOptions]="{standalone: true}"
                (keyup.enter)="agregarTemaEspecifico()"
                placeholder="Ej: Derivadas de funciones compuestas"
                maxlength="50"
                class="w-full pl-10 pr-16 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <button
                type="button"
                (click)="agregarTemaEspecifico()"
                [disabled]="!nuevoTema.trim() || temasEspecificos.length >= 10"
                class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                <mat-icon class="text-sm">add</mat-icon>
              </button>
            </div>
          </div>

          <!-- Lista de Temas -->
          <div class="space-y-3" *ngIf="temasEspecificos.length > 0">
            <div
              *ngFor="let tema of temasEspecificos; let i = index"
              class="flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-lg">
              <mat-icon class="text-green-600">check_circle</mat-icon>
              <span class="flex-1 text-gray-800">{{ tema }}</span>
              <button
                type="button"
                (click)="eliminarTemaEspecifico(i)"
                class="text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors">
                <mat-icon class="text-sm">close</mat-icon>
              </button>
            </div>
          </div>
          <div class="text-sm text-gray-600" *ngIf="temasEspecificos.length > 0">
            {{ temasEspecificos.length }} / 10 temas agregados
          </div>
        </section>

        <!-- Mensaje de Error General -->
        <div class="flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg" *ngIf="error">
          <mat-icon class="text-red-500 text-xl mt-0.5">error</mat-icon>
          <div>
            <h3 class="text-red-800 font-medium">Error al crear</h3>
            <p class="text-red-700">{{ error }}</p>
          </div>
        </div>

        <!-- Botones de Acción -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
          <button
            mat-stroked-button
            type="button"
            class="flex-1 sm:flex-none sm:px-8 py-3 border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors"
             (click)="cancelar()"
            [disabled]="isSubmitting">
            <mat-icon class="mr-2">close</mat-icon>
            Cancelar
          </button>

          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="flex-1 sm:flex-none sm:px-8 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
            [disabled]="isSubmitting || tutoriaForm.invalid">
            <mat-spinner diameter="20" class="mr-2" *ngIf="isSubmitting"></mat-spinner>
            <mat-icon class="mr-2" *ngIf="!isSubmitting">add</mat-icon>
            <span>{{ isSubmitting ? 'Creando...' : 'Crear Tutoría' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>